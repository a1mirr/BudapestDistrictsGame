<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Find the Budapest district!</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body, html { margin:0; padding:0; height:100% }
    #map { width:100%; height:90% }
    #info { padding: 10px; text-align:center }
    .incorrect { fill: rgba(255,0,0,0.5); }
    .correct { fill: rgba(0,255,0,0.5); }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="info">
    <span id="prompt">Loading...</span>
    <button id="next">Next district</button>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
  </script>
  <script>
    let map = L.map('map').setView([47.5, 19.0], 11);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',
      { maxZoom: 18 }).addTo(map);

    let districtsLayer, data, targetName, attempts;
    const info = document.getElementById('prompt');
    const btnNext = document.getElementById('next');

    fetch('Budapest_districts.json')
      .then(r => r.json())
      .then(json => {
        data = json;
        startNewRound();
      });

    function style(feature) {
      return { color: '#555', weight: 1, fillColor: 'white', fillOpacity: 0.5 };
    }

    function highlight(layer, cls) {
      layer.setStyle({ fillOpacity: 0.7 });
      layer.getElement().classList.add(cls);
    }

    function resetHighlight(layer) {
      layer.setStyle({ fillOpacity: 0.5, fillColor: 'white' });
      let el = layer.getElement();
      if (el) el.classList.remove('incorrect','correct');
    }

    function onEachFeature(feature, layer) {
      layer.on('click', () => {
        if (attempts === 0) return;
        let name = feature.properties.name;
        if (name === targetName) {
          highlight(layer, 'correct');
          info.textContent = 'Correct! It's ' + name;
          attempts = 0;
        } else {
          highlight(layer, 'incorrect');
          info.textContent = 'Incorrect! It's ' + name;
          attempts--;
          if (attempts === 0) {
            info.textContent = 'You have 0 attempts left! Correct location of: ' + targetName;
            districtsLayer.eachLayer(l => {
              if (l.feature.properties.name === targetName)
                highlight(l, 'correct');
            });
          }
        }
      });
      layer.on('mouseout', () => {});
    }

    function startNewRound() {
      if (districtsLayer) map.removeLayer(districtsLayer);
      districtsLayer = L.geoJSON(data, {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(map);

      let names = data.features.map(f => f.properties.name);
      targetName = names[Math.floor(Math.random()*names.length)];
      attempts = 3;
      info.textContent = 'Find the district: ' + targetName + ' | Attempts: ' + attempts;
    }

    btnNext.addEventListener('click', startNewRound);
  </script>
</body>
</html>